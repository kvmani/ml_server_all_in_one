{% extends "base.html" %}
{% block title %}PDF Tools{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{{ url_for('pdf_tools.static', filename='css/index.css') }}">
{% endblock %}
{% block content %}
  {% set merge_upload = plugin_settings.get('merge_upload', {}) %}
  {% set split_upload = plugin_settings.get('split_upload', {}) %}
  {% set docs_url = plugin_settings.get('docs') %}
  {% set merge_max_files = merge_upload.get('max_files', 10) %}
  {% set merge_max_mb = merge_upload.get('max_mb', 5) %}
  {% if docs_url %}
    {% set help_href = docs_url + ('&' if '?' in docs_url else '?') + 'theme=' + current_theme %}
  {% else %}
    {% set help_href = url_for('help_page', slug='pdf_tools', theme=current_theme) %}
  {% endif %}
    <section class="shell surface-block pdf-shell" aria-labelledby="pdf-tools-title">
    <div class="tool-shell__layout">
      <aside class="tool-shell__intro">
        <div class="tool-shell__icon" aria-hidden="true">
          <img src="{{ url_for('pdf_tools.static', filename='img/pdf_tools_icon.png') }}" alt="">
        </div>
        <p class="tool-card__category">Document Utilities</p>
        <h1 id="pdf-tools-title" class="section-heading">PDF toolkit workspace</h1>
        <p>
          Reorder, merge, and split PDF documents entirely in-memory. Drag files into the workspace to queue them, define page
          ranges with inline validation, and export results instantly.
        </p>
        <ul>
          <li>Supports drag &amp; drop or secure file browsing</li>
          <li>Granular page ranges with per-file tooltips</li>
          <li>Instant first-page thumbnails with inline full previews</li>
          <li>Instant downloads without server persistence</li>
        </ul>
        <div class="tool-shell__actions">
          <a class="btn btn--subtle" data-keep-theme href="{{ help_href }}">Read PDF guide</a>
        </div>
        <div class="surface-muted">
          <p class="form-field__hint">
            Merge up to {{ merge_max_files }} PDFs ({{ merge_max_mb }} MB each). Split accepts one PDF up to {{ split_upload.get('max_mb', 5) }} MB.
          </p>
          <div class="tag-list">
            <span class="badge">Offline merge</span>
            <span class="badge">Queue reordering</span>
          </div>
        </div>
      </aside>

      <div class="tool-shell__workspace">
        <form id="merge-form" class="surface-muted merge-panel" aria-describedby="merge-status">
          <header class="merge-panel__header">
            <div>
              <p class="tool-card__category">Merge PDFs</p>
              <h2 class="form-section__title">Build a combined document</h2>
            </div>
            <div class="merge-output">
              <label class="form-field__label" for="merge-output">
                Output filename
                <button type="button" class="tooltip-trigger" data-tooltip="Use .pdf extension. Default name is merged.pdf." aria-label="Output filename help">?</button>
              </label>
              <input id="merge-output" type="text" value="merged.pdf" autocomplete="off">
            </div>
          </header>

          <div class="dropzone" id="merge-dropzone" data-max-files="{{ merge_max_files }}" data-max-mb="{{ merge_max_mb }}">
            <div class="dropzone__copy">
              <h3 class="section-heading">Drop PDFs to queue</h3>
              <p class="dropzone__hint">Drag up to {{ merge_max_files }} PDFs ({{ merge_max_mb }} MB each) or use the Add files button.</p>
            </div>
            <div class="dropzone__actions">
              <button class="btn" type="button" id="add-merge-files">Add files</button>
              <button class="btn btn--ghost" type="button" id="clear-merge">Clear queue</button>
            </div>
            <input id="merge-picker" type="file" accept="application/pdf" multiple class="visually-hidden">
          </div>

          <div id="merge-entries" class="merge-entries" aria-live="polite"></div>
          <p id="merge-status" class="status-text" data-role="status" aria-live="polite"></p>
          <div class="form-actions merge-actions">
            <button class="btn" type="submit">Merge selected</button>
          </div>
        </form>

        <section class="surface-muted split-panel">
          <header>
            <p class="tool-card__category">Split PDF</p>
            <h2 class="form-section__title">Export each page</h2>
          </header>
          <form id="split-form" class="form-grid" enctype="multipart/form-data" novalidate>
            <div class="dropzone" id="split-dropzone">
              <div class="dropzone__copy">
                <h3 class="section-heading">Drop a PDF to split</h3>
                <p class="dropzone__hint">Each page becomes an individual download. Single file up to {{ split_upload.get('max_mb', 5) }} MB.</p>
              </div>
              <div class="dropzone__actions">
                <button class="btn" type="button" id="split-browse">Choose PDF</button>
              </div>
              <input id="split-file" name="file" type="file" accept="application/pdf" class="visually-hidden" required>
            </div>
            <p id="split-status" class="status-text" data-role="status" aria-live="polite"></p>
            <div id="split-results" class="surface-muted split-results" hidden>
              <h3 class="form-section__title">Pages ready</h3>
              <ul class="list-reset" aria-live="polite"></ul>
            </div>
          </form>
        </section>
      </div>
    </div>
  </section>
{% endblock %}
{% block scripts %}
<script type="module" src="{{ url_for('pdf_tools.static', filename='js/index.js') }}"></script>
{% endblock %}
