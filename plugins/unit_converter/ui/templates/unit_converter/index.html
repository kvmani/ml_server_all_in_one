{% extends "base.html" %}
{% block title %}Unit Converter{% endblock %}
{% block content %}
  {% set docs_url = plugin_settings.get('docs') if plugin_settings is defined else None %}
  {% if docs_url %}
    {% set help_href = docs_url + ('&' if '?' in docs_url else '?') + 'theme=' + current_theme %}
  {% else %}
    {% set help_href = url_for('help_page', slug='unit_converter', theme=current_theme) %}
  {% endif %}
  <section class="shell surface-block" aria-labelledby="unit-converter-title">
    <div class="tool-shell__layout">
      <aside class="tool-shell__intro">
        <div class="tool-shell__icon" aria-hidden="true">
          <img src="{{ url_for('unit_converter.static', filename='img/UnitConverter_icon.png') }}" alt="">
        </div>
        <p class="tool-card__category">General Utilities</p>
        <h1 id="unit-converter-title" class="section-heading">Scientific unit converter</h1>
        <p>
          Convert between laboratory units, inspect base quantities, and validate interval calculations without leaving the offline workspace.
          Choose a unit family, configure precision and notation, and view the converted value alongside the base SI representation.
        </p>
        <ul>
          <li>Unit registry powered by Pint with engineering materials presets</li>
          <li>Toggle between absolute and interval temperature conversions</li>
          <li>Evaluate composite expressions such as <code>5 kJ/mol to eV</code></li>
        </ul>
        <div class="tool-shell__actions">
          <a class="btn btn--subtle" data-keep-theme href="{{ help_href }}">Read conversion guide</a>
        </div>
      </aside>

      <div class="tool-shell__workspace">
        <form id="converter-form" class="surface-muted form-grid" novalidate data-units='{{ units|tojson }}'>
          <div class="input-grid">
            <div class="form-field">
              <label class="form-field__label" for="family">
                Unit family
                <button type="button" class="tooltip-trigger" data-tooltip="Families group compatible dimensions (e.g. mass, pressure)." aria-label="Unit family help">?</button>
              </label>
              <select id="family" name="family" required>
                {% for family in families %}
                  <option value="{{ family }}">{{ family.replace('_', ' ')|title }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="value">
                Value
                <button type="button" class="tooltip-trigger" data-tooltip="Enter a numeric quantity using decimal or scientific notation." aria-label="Value help">?</button>
              </label>
              <input id="value" name="value" type="text" inputmode="decimal" autocomplete="off" required>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="from-unit">From unit</label>
              <select id="from-unit" name="from_unit" required></select>
              <p class="form-field__hint" id="from-hint"></p>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="to-unit">To unit</label>
              <select id="to-unit" name="to_unit" required></select>
              <p class="form-field__hint" id="to-hint"></p>
            </div>
          </div>

          <div class="input-grid">
            <div class="form-field">
              <label class="form-field__label" for="mode">Conversion mode</label>
              <select id="mode" name="mode">
                <option value="absolute">Absolute (default)</option>
                <option value="interval">Interval / delta</option>
              </select>
              <p class="form-field__hint">Interval mode keeps offsets for temperature differences.</p>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="sig-figs">Significant figures</label>
              <input id="sig-figs" name="sig_figs" type="number" min="1" max="12" step="1" placeholder="e.g. 4">
              <p class="form-field__hint">Leave blank to auto-select.</p>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="decimals">Fixed decimals</label>
              <input id="decimals" name="decimals" type="number" min="0" max="12" step="1" placeholder="e.g. 3">
              <p class="form-field__hint">Overrides significant figures when set.</p>
            </div>
            <div class="form-field">
              <label class="form-field__label" for="notation">Notation</label>
              <select id="notation" name="notation">
                <option value="auto">Automatic</option>
                <option value="scientific">Scientific</option>
                <option value="engineering">Engineering</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn" type="submit">Convert value</button>
            <button class="btn btn--ghost" type="reset" id="converter-reset">Reset</button>
          </div>
          <p class="status-text" data-role="status" aria-live="polite"></p>
        </form>

        <section class="surface-muted" aria-live="polite" id="converter-output" hidden>
          <h2 class="form-section__title">Conversion result</h2>
          <p id="result" class="section-heading"></p>
          <p id="base" class="form-field__hint"></p>
        </section>

        <section class="surface-muted" aria-labelledby="expression-title">
          <h2 id="expression-title" class="form-section__title">Evaluate unit expression</h2>
          <form id="expression-form" class="form-grid" novalidate>
            <div class="input-grid">
              <div class="form-field">
                <label class="form-field__label" for="expression">
                  Expression
                  <button type="button" class="tooltip-trigger" data-tooltip="Examples: '5 kJ/mol to eV', '1.2e6 Pa to bar', or '980 cm^3 * 7 g/cm^3 to kilogram'." aria-label="Expression help">?</button>
                </label>
                <input id="expression" name="expression" placeholder="e.g. 5 kJ/mol to eV" required autocomplete="off">
              </div>
              <div class="form-field">
                <label class="form-field__label" for="expression-target">Target unit (optional)</label>
                <input id="expression-target" name="target" placeholder="Only needed if expression omits 'to <unit>'">
              </div>
              <div class="form-field">
                <label class="form-field__label" for="expression-notation">Notation</label>
                <select id="expression-notation" name="notation">
                  <option value="auto">Automatic</option>
                  <option value="scientific">Scientific</option>
                  <option value="engineering">Engineering</option>
                </select>
              </div>
              <div class="form-field">
                <label class="form-field__label" for="expression-sig-figs">Significant figures</label>
                <input id="expression-sig-figs" name="sig_figs" type="number" min="1" max="12" step="1">
              </div>
            </div>
            <div class="form-actions">
              <button class="btn" type="submit">Evaluate expression</button>
              <button class="btn btn--ghost" type="reset" id="expression-reset">Reset</button>
            </div>
            <p class="status-text" data-role="status" aria-live="polite"></p>
          </form>
          <div id="expression-output" hidden aria-live="polite">
            <p class="section-heading" id="expression-result"></p>
          </div>
        </section>
      </div>
    </div>
  </section>
{% endblock %}
{% block scripts %}
  <script type="module" src="{{ url_for('unit_converter.static', filename='js/index.js') }}"></script>
{% endblock %}
